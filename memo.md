# メモ

- 値オブジェクト  
- エンティティ  
- ドメインサービス  
- リポジトリ  
- アプリケーションサービス  
- ファクトリ  
- トランザクション  
- 集約  
- 仕様  

## 値オブジェクト

値オブジェクトはドメインオブジェクトの基本です。  

- 状態を不変に保つ  
- 値同士の比較ができる  
- 完全に交換可能である  

## エンティティ

エンティティは値オブジェクトと対を為すドメインオブジェクトです。  

- 可変である  
- 同じ属性であっても区別される  
- 同一性により区別される  

## ドメインサービス

ドメインサービスは不自然さを解消します。  

ドメインの概念を知識として落とし込み、それをコードで表現しようとした時、値オブジェクトやエンティティの振る舞いとして定義すると違和感が生じる物が存在します。  
この違和感はドメインの物を表現しようとしたときよりも、ドメインの活動を表現しようとするときに見られる傾向があります。  
違和感のある振る舞いを値オブジェクト等に無理やり実装しようとすると、オブジェクトの責務を歪な物に変えてしまいます。  
このような時に求められることは、その振る舞いをまた別のオブジェクトとして定義する事です。  
ドメインサービスはそのような不自然さを解決するオブジェクトです。  

## リポジトリ

リポジトリは永続化や再構築を担います。

ソフトウェアを継続して成長指せるためにはコードの意図を明確にする事が求められます。  
オブジェクトの永続化(保存)や再構築(復元)といった操作は重要ですが、データストアを操作するコードはプログラムの意図をぼやけさせます。  
意図を明確にするにはデータストアにまつわる処理を切り離す事が必要です。  
リポジトリはそういった操作を抽象的に扱えるように仕立てて、処理の意図を明確にすることを可能にします。  

ドメイン駆動設計でデータの永続化の処理を行うのはリポジトリと呼ばれるオブジェクトです。  
リポジトリはエンティティ毎(厳密には集約毎)に用意します。  

## アプリケーションサービス

アプリケーションサービスはドメインオブジェクトを強調させてユースケースを実現します。  

値オブジェクトやエンティティといったドメインオブジェクトはドメインモデルをコードによって表現したオフジェクトです。  
ソフトウェアとして利用者の問題を解決するためには、これらのドメインオブジェクトをまとめ上げて問題を解決するように導く必要があります。  
アプリケーションサービスはドメインオブジェクトが行うタスクの進行を管理し、問題の解決に導くものです。  

## ファクトリ

ファクトリは作る知識に特化したオブジェクトです。  

オブジェクトの生成は時に複雑な手順を必要とします。  
そういった手順は、モデルを表現するオブジェクトに無理やり実装するよりも、オブジェクトの生成それ自体を独立したオブジェクトとする方がコードの意図を明確にすることに繋がります。  
道具を作ることと道具を使う事は全く別の知識であるのと同様に、オブジェクト生成の責務はモデルを表現するオブジェクトには相応しくないのです。  

ファクトリはオブジェクトを生成する責務を持ったオブジェクトです。  

## トランザクション

システムにはデータの整合性を保つことが求められます。  

データの整合性を保つための施策はソフトウェア開発における重大なテーマです。  
一般的に整合性を保つために利用されるのはトランザクションです。  
ドメイン駆動設計に限った話ではありませんが、トランザクションは、ソフトウェアシステムを形作る上で必ず必要となるものです。  

## 集約

集約はデータの変更の単位です。

データを変更するための単位として扱われるオブジェクトの集まりを集約と言います。
集約にはルートとなるオブジェクトが存在し、全ての操作はルート越しに行われます。
そのようにして集約内部への操作に制限が掛けられ、集約内の不変条件は維持されます。
集約はデータの変更の単位であるため、トランザクションやロック友密接に関係する物です。

集約はトランザクションの単位で切り出すとよいとよく言われます。

## 仕様

オブジェクトの評価を行うオブジェクトです。  

オブジェクトの評価は時に複雑な手順が必要となります。  
こうした評価処理をオブジェクトのメソッドとして定義すると、オブジェクト本来の趣旨を見えづらくしてしまうことがあります。  
評価処理はオブジェクトに定義する以外に、評価自体をオブジェクトとして切り出すことが可能です。  
そうして切り出された条件に合致しているかどうかを見極めるオブジェクトが「仕様」です。  
